由于这次低代码平台使用的Vue3，为了更好地利用Ts，我们使用pinia作为全局数据管理

# 系统结构组成

需要全局数据管理的模块包括编辑器和渲染器。由于编辑器和渲染器本身分属两个模块，运行时环境没有交集，虽然有共同之处，但数据互不联系，因此各自的store是独立初始化的。

但是对于组件的操作是需要有统一性的，一方面是组件的加载、注册，另一方面则是组件本身也需要全局数据管理来存储状态，例如组件的属性、组件的配置等等，这就需要编辑器和渲染器为组件开辟相关的store空间；同时组件对于自身属性的读取和设置，都需要由运行时的编辑器或渲染器来代理完成，因此组件这一部分的相关pinia代码就统一收口到mao-core中

# 模块数据管理结构

接下来简单介绍下各个模块需要的全局数据内容，在这里就暂且不放详细代码设计，留到后续进行到该模块时再做详细介绍

## 编辑器

![描述](https://pic2.zhimg.com/80/v2-abcb9f8601998ac8a2732698f4979753_1440w.webp)

1、组件市场

存储所有可用的组件，编辑器初始化时执行加载和注册。由于低代码平台组件解耦，因此编辑器market中的数据从组件托管平台动态拉取并注入（这一步操作涉及组件的低代码平台封装方案，后续文章介绍）。

拉取后会将组件的视图、属性、配置项存储到market中，后续从market中读取所有组件，然后就可以在编辑器左侧渲染出所有可用组件的列表。

2、组件管理

点击组件列表中的组件，或者将其拖拽到画布，都会将组件注册到manager中，这就是上文提到的为组件本身的全局数据提供的数据空间。其state为一个以组件eid为key的哈希表。这项数据与页面动态绑定，直接参与最终成品页面的渲染。

由于组件外挂，组件对于自身属性和配置的消费均由编辑器的manager代理完成，以某个文本组件读取需要渲染的文本属性为例，其请求路径大致如下：


![描述](https://pic2.zhimg.com/80/v2-9edd593c82d3ce57d54299d8d18010f9_1440w.webp)

3、编辑器其他数据

用于存储编辑器的历史操作，重做、回退等，以及编辑器的schema编译生成、渲染页面接口调用、页面保存发布等功能

## 渲染器

渲染器的结构和编辑器大致类似，也是分为market和manager。但不同的是，编辑器下market为所有的可用组件，manager中的组件由用户手动添加组件时注册。

但渲染器中已经预先确定好了要加载的组件资源（这一步涉及低代码页面的动态组装生成，后续文章介绍），同时在加载完后自动执行注册到manager中完成页面的渲染。